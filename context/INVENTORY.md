Of course. Here is a comprehensive inventory of the Ambulando codebase.

### Codebase Inventory: Ambulando

---

### 1. Project Overview

Ambulando is a voice-first social media application built on the decentralized [Nostr](https://nostr.com) protocol. The core concept is to create a more intimate and authentic social space where users share and interact through 60-second audio messages, visualized as waveforms. The name "Ambulando" (Latin for "by walking") reflects the philosophy of fostering thoughtful, flowing conversations.

-   **Main Technologies**:
    -   **UI**: Swift, SwiftUI
    -   **Protocol**: Nostr (via `NDKSwift` library)
    -   **Audio**: `AVFoundation` for recording and playback.
    -   **Project Generation**: XcodeGen is used to generate the `.xcodeproj` from a `project.yml` file.
    -   **Dependencies**: Swift Package Manager manages dependencies, including `NDKSwift`, `NDKSwiftUI`, and `GRDB.swift` (for caching).
-   **Architecture Style**:
    -   The application follows a modern **MVVM (Model-View-ViewModel)** architecture, which is idiomatic for SwiftUI.
    -   State is managed through a combination of `@State` / `@StateObject` for local view state and `@EnvironmentObject` for shared, global state objects (`NostrManager`, `AppState`).
    -   Data flow is reactive, leveraging Swift's `async/await` and `AsyncStream` for live updates from the Nostr network.

---

### 2. Directory Structure

The repository is organized in a standard, modern iOS project structure, with a clear separation of concerns facilitated by the MVVM pattern.

| Path                          | Purpose                                                                                                                                                                                                                           |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `.github/workflows/`          | Contains GitHub Actions workflows for Continuous Integration (`ci.yml`) and TestFlight deployment (`testflight.yml`).                                                                                                               |
| `Ambulando.xcodeproj/`        | The Xcode project file. **Note:** This is generated by XcodeGen from `project.yml` and should not be edited directly.                                                                                                                |
| `Sources/Ambulando/`          | The main source code for the application, structured by feature and type.                                                                                                                                                           |
| `┣━ Models/`                  | Contains the data models for the application, such as `AudioEvent` and `BlossomError`. These are plain Swift structs that represent the core data.                                                                                   |
| `┣━ Networking/`              | Networking utilities. Contains a `URLSession` extension to configure a custom User-Agent, a best practice for API clients.                                                                                                        |
| `┣━ Shapes/`                  | Custom SwiftUI `Shape` definitions, like `FootprintShape`, used for branding and UI elements.                                                                                                                                       |
| `┣━ ViewModels/`              | Contains ViewModels that encapsulate presentation logic and state for complex views (e.g., `OutboxDebugViewModel`).                                                                                                                     |
| `┣━ Views/`                   | Contains all SwiftUI views, further organized into subdirectories.                                                                                                                                                                |
| `┃  ┗━ Debug/`                | A comprehensive suite of debug views for inspecting the app's internal state, including caching, relay subscriptions, and outbox models. A key feature for developing on a decentralized protocol.                                  |
| **(Root Directory)**          | **Configuration & Scripts**                                                                                                                                                                                                       |
| `┣━ .gitignore` (modified)    | Standard Git ignore file for Xcode projects, configured to exclude user-specific files, build artifacts (`DerivedData/`), and temporary files. Essential for maintaining a clean repository.                                          |
| `┣━ build.sh` (modified)      | A shell script to automate the build process. It first runs `xcodegen` and then builds the app using `xcodebuild` with `xcbeautify` for clean output. Useful for CI and local command-line builds.                                      |
| `┣━ project.yml`              | The source of truth for the Xcode project. Defines targets, dependencies, build settings, and file structure. Developers should edit this file instead of the `.xcodeproj`.                                                         |
| `┣━ refresh-project.sh`        | A utility script to run `xcodegen generate`, ensuring the Xcode project is up-to-date with any changes in `project.yml` or the file system.                                                                                       |
| `┣━ deploy.sh`                | A simple script to initiate the TestFlight deployment process.                                                                                                                                                                    |
| `┣━ Package.resolved`         | A file generated by Swift Package Manager that locks down the exact versions of all dependencies, ensuring reproducible builds.                                                                                                     |

---

### 3. Significant Files

These files are central to the application's functionality, configuration, and architecture.

| File Path                               | Description                                                                                                                                                 |
| --------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Sources/Ambulando/AmbulandoApp.swift`  | The main entry point of the app. Initializes and provides the core `NostrManager` and `AppState` environment objects.                                           |
| `Sources/Ambulando/ContentView.swift`   | The root view. It checks for an active session and routes the user to either the `AuthenticationView` or the `HomeFeedView`.                                     |
| `Sources/Ambulando/Views/HomeFeedView.swift` | The primary screen for users, displaying the feed of audio events and containing the entire audio recording, uploading, and publishing workflow.                |
| `Sources/Ambulando/Views/AuthenticationView.swift` | Manages the user login process, supporting multiple Nostr authentication methods (`nsec`, `NIP-46`).                                                       |
| `Sources/Ambulando/Views/AudioEventCard.swift` | A complex, self-contained view for displaying a single audio post. Manages its own playback, fetches reactions, and displays author/reply metadata.       |
| `AmbulandoApp.swift` > `NostrManager`   | The central class for all Nostr protocol interactions. It configures `NDKSwift`, manages relays, and handles the user session lifecycle.                            |
| `AmbulandoApp.swift` > `AppState`       | A global `ObservableObject` for shared UI state, such as recording status, current audio playback, and reply context.                                            |
| `project.yml`                           | The XcodeGen spec file. This is the canonical source for the project's structure, dependencies, and build settings.                                               |
| `.gitignore`                            | Prevents transient, user-specific, and built files from being committed to source control, ensuring a clean and consistent repository for all collaborators.      |
| `build.sh`                              | Automates the project generation and build steps, providing a consistent build process for both local development and CI environments.                            |
| `README.md`                             | A detailed and well-written document providing a high-level overview of the project's philosophy, features, and setup instructions.                               |
| `.github/workflows/ci.yml`              | Defines the Continuous Integration a- **MVVM Pattern**: The codebase is clearly structured around the Model-View-ViewModel pattern.
  -   **Models** (`Sources/Ambulando/Models/`): Plain data structures like `AudioEvent` that represent the application's data. They are protocol-agnostic.
  -   **Views** (`Sources/Ambulando/Views/`): Declarative SwiftUI views responsible for the UI. They are generally lightweight and react to state changes.
  -   **ViewModels** (`Sources/Ambulando/ViewModels/`): While not used for every view, they appear for more complex screens like `OutboxDebugView` to hold presentation logic. For other views, the logic is often contained within the view itself or delegated to an Environment Object.

-   **State Management**:
    -   **Global/Shared State**: Managed by two key `@EnvironmentObject`s:
        -   `NostrManager`: A singleton-like class that orchestrates all Nostr-related data fetching, publishing, and session management. It acts as the primary interface to the `NDKSwift` library.
        -   `AppState`: Manages transient UI state shared across the app, such as `isRecording`, `currentlyPlayingId`, and `replyingTo` context.
    -   **Local State**: Managed within individual SwiftUI views using `@State` and `@StateObject`.

-   **Data Flow**:
    -   The application's data flow is reactive and asynchronous, driven by user actions and network events from Nostr relays.
    -   **Outbound**: UI actions trigger methods on `NostrManager` or `AppState`, which in turn use `NDKSwift` to publish events to Nostr relays.
    -   **Inbound**: `NostrManager` uses `NDKSwift`'s `observe` function to create `AsyncStream`s of events from relays. Views subscribe to these streams (or to `@Published` properties that are updated by them) and update reactively.

-   **Key Design Decisions**:
    -   **Xcode Project Generation**: Using `xcodegen` decouples the project definition from the binary `.xcodeproj` format. This makes project settings more transparent, version-controllable, and less prone to merge conflicts.
    -   **Comprehensive Debug Suite**: The extensive `Views/Debug/` directory is a significant architectural decision. For a decentralized app where behavior can be unpredictable, providing tools to inspect caches, active subscriptions, and network state is invaluable for development and troubleshooting.
    -   **Modular Views**: Components like `AudioEventCard` are designed to be self-contained, managing their own data fetching (profiles, reactions) and state (playback), making the main feed view cleaner.
    -   **Custom Networking Layer**: The `URLSessionConfiguration+UserAgent.swift` file shows a proactive approach to networking, ensuring the app identifies itself correctly to web services, which can prevent being blocked.

---

### 5. High-Complexity Modules

The following modules contain significant business logic, state management, and interaction with external frameworks, making them more complex than others.

1.  **Home Feed & Recording Workflow**
    -   **File Path**: `Sources/Ambulando/Views/HomeFeedView.swift`
    -   **Reason for Complexity**: This view is the application's centerpiece and juggles multiple, overlapping responsibilities. It manages:
        -   The live-streaming, filtering (by relay), and sorting of a dynamic list of audio events.
        -   The entire audio recording lifecycle using `AVAudioRecorder`, including permissions, state transitions (recording -> complete -> uploading -> preview), and UI updates (waveform metering, timers).
        -   The audio upload process to a Blossom server, which is an asynchronous network operation.
        -   The audio publishing process to Nostr relays, which involves creating a specially formatted Nostr event.
        -   The playback of the recorded preview using `AVAudioPlayer` before publishing.
        -   Complex state management to coordinate these different modes without conflict.

2.  **Authentication Flow**
    -   **File Path**: `Sources/Ambulando/Views/AuthenticationView.swift`
    -   **Reason for Complexity**: This module is responsible for handling multiple, distinct Nostr authentication methods, each with its own asynchronous flow:
        -   **nsec (private key)**: A direct login method.
        -   **NIP-46 (Nostr Connect)**: A more complex, multi-step remote signing protocol that can be initiated via `bunker://` URIs or NIP-05 identifiers. This requires orchestrating a connection to a remote signer, potentially displaying an auth URL to the user, and waiting for approval before completing the login.
        -   The view also contains intricate intro animations, adding to its state management complexity.

---

### JSON Output for High-Complexity Modules